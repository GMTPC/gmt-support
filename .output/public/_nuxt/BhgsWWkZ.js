import{at as r,A as n}from"./BX3DXnrd.js";const a=r("fixAssets",{state:()=>({tickets:[],loaded:!1}),actions:{normalize(){if(this.tickets||(this.tickets=[]),!Array.isArray(this.tickets))try{const t=this.tickets;t&&typeof t=="object"?this.tickets=Object.values(t).filter(Boolean):this.tickets=[]}catch{this.tickets=[]}(!this.tickets||this.tickets.length===0)&&(this.tickets=[{id:(Date.now()-2e3).toString(),title:"ทดสอบ: ติดตั้งเครื่องพิมพ์",description:"เครื่องพิมพ์ชำรุด ปริ้นไม่ได้ ต้องการตรวจสอบและเปลี่ยนชิ้นส่วน",priority:"High",fileName:null,status:"draft",createdAt:new Date(Date.now()-1e3*60*60).toISOString()},{id:(Date.now()-100).toString(),title:"ทดสอบ: ปรับปรุงระบบเครือข่าย",description:"สลับ switch บนชั้น 3 และทดสอบความเร็ว",priority:"Normal",fileName:null,status:"submitted_it",createdAt:new Date().toISOString()}])},async load(){try{const e=await Promise.race([$fetch("/api/tickets"),new Promise((i,s)=>setTimeout(()=>s(new Error("timeout")),5e3))]);this.tickets=e||[]}catch(e){console.warn("Failed to load tickets, using fallback:",e&&e.message),this.normalize()}finally{this.loaded=!0}return this.tickets},async createTicket(t){try{const e=await $fetch("/api/tickets",{method:"POST",body:t});return this.tickets.unshift(e),e}catch{const i={id:Date.now().toString(),title:t.title||"",description:t.description||"",priority:t.priority||"Normal",status:t.status||"draft",fileName:t.fileName||null,createdAt:new Date().toISOString()};return this.tickets.unshift(i),i}},async updateTicket(t,e){try{const i=await $fetch(`/api/tickets/${t}`,{method:"PUT",body:e}),s=this.tickets.findIndex(c=>String(c.id)===String(t));return s!==-1&&(this.tickets[s]=i),i}catch{const s=this.tickets.findIndex(c=>String(c.id)===String(t));return s===-1?null:(this.tickets[s]={...this.tickets[s],...e},this.tickets[s])}},async removeTicket(t){try{const e=await $fetch(`/api/tickets/${t}`,{method:"DELETE"});return this.tickets=this.tickets.filter(i=>String(i.id)!==String(t)),e}catch{return this.tickets=this.tickets.filter(i=>String(i.id)!==String(t)),{success:!0}}},getTicket(t){return this.tickets.find(e=>String(e.id)===String(t))||null}}});function k(){const t=a();return t.loaded||t.load(),{tickets:t.tickets,createTicket:(...e)=>t.createTicket(...e),updateTicket:(...e)=>t.updateTicket(...e),removeTicket:(...e)=>t.removeTicket(...e),getTicket:e=>t.getTicket(e),load:()=>t.load(),loaded:n(()=>t.loaded)}}export{a,k as u};
