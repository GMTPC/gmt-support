import{_ as J}from"./D1NlPZts.js";import{_ as K}from"./CRzN-RqF.js";import{a as R}from"./CgY8vmlM.js";import{u as Q}from"./BhgsWWkZ.js";import{u as W}from"./h9GH4c1g.js";import{_ as X,k as Y,al as Z,r as s,ao as q,h as y,a as l,w as t,o as f,c as F,b as n,t as v,f as u,V as d,H as h,F as ee,j as le,u as te}from"./BX3DXnrd.js";import{a as B,V as p}from"./Dcv5vhZ4.js";import{V as ae}from"./CT0Nqr-g.js";import{V as oe}from"./BrBP5ZB7.js";import{c as D,a as b,e as T,V as C}from"./CEv2fZCT.js";import{V as ue}from"./DDt4p3us.js";import{V as re}from"./Dc67yaJp.js";import{V as se,a as ie,b as ne}from"./8gBy0bTw.js";import{V as de}from"./-1Oo1DPM.js";import{V as me}from"./CZXLAAch.js";import{V as fe}from"./DvB9e70b.js";import{V as ve}from"./DWYXe89p.js";import{V as pe}from"./C84KPyP5.js";import{V as ce}from"./kQPmhJOm.js";/* empty css        */import"./BFwkMqJ3.js";import"./DWGaNmQL.js";import"./DScwcNyu.js";import"./DSgduqRd.js";import"./BudtlS_C.js";import"./1Ywhgt5G.js";import"./B2HVLM-N.js";import"./DEKsWHAV.js";const Ve={class:"pa-4"},_e={class:"d-flex align-center gap-3"},ge={class:"text-muted small"},we={key:1},ke={__name:"[id]",setup(xe){const j=Y(),H=Z(),{getTicket:P,updateTicket:L,removeTicket:$}=Q(),N=j.params.id,a=s(null);q(()=>{N&&(a.value=P(N))}),W({title:a.value?`${a.value.title} - GMT SUPPORT`:"แก้ไขแจ้งซ่อม - GMT SUPPORT"});const w=s(null),c=s(""),V=s(""),i=s("Normal"),_=s(null),A=[r=>!!r||"กรุณากรอกหัวข้อ"];q(()=>{a.value&&(c.value=a.value.title,V.value=a.value.description,i.value=a.value.priority||"Normal",_.value=a.value.fileName?{name:a.value.fileName}:null)});async function I(){var e;!a.value||!(!w.value||await w.value.validate())||(L(a.value.id,{title:c.value,description:V.value,priority:i.value,fileName:((e=_.value)==null?void 0:e.name)||null}),x.value="บันทึกเรียบร้อย",g.value=!0)}const S={draft:["pending_approval","submitted_it","cancelled"],pending_approval:["approved","rejected","revised","cancelled"],submitted_it:["it_received","cancelled"],it_received:["in_queue","assigned","cancelled"],in_queue:["assigned","cancelled"],assigned:["in_progress","on_hold","cancelled"],in_progress:["waiting_user","waiting_parts","completed","cancelled"],waiting_user:["in_progress","cancelled"],waiting_parts:["in_progress","cancelled"],completed:["user_confirmation","closed","replaced"],user_confirmation:["closed","revised"],default:["cancelled"]};function M(r){return S[r]||S.default}async function z(r){if(a.value)try{await L(a.value.id,{status:r}),x.value=`สถานะเปลี่ยนเป็น: ${R(r)}`,g.value=!0}catch(e){console.error("Failed to change status",e)}}const m=s(!1),k=s(!1),g=s(!1),x=s("");function E(){a.value&&(m.value=!0)}async function G(){if(a.value){k.value=!0;try{await $(a.value.id),H.push("/it-service-request")}catch(r){console.error("Delete failed",r)}finally{k.value=!1,m.value=!1}}}return(r,e)=>{const O=J,U=K;return f(),y("div",Ve,[l(B,null,{default:t(()=>[l(p,{cols:"12"},{default:t(()=>[l(O,{showHome:!0,items:[{text:"แจ้งซ่อม",to:"/it-service-request"},{text:a.value?a.value.title:"แก้ไขแจ้งซ่อม"}]},null,8,["items"]),a.value?(f(),F(C,{key:0,class:"card-form"},{default:t(()=>[l(D,{class:"d-flex align-center justify-space-between"},{default:t(()=>[e[8]||(e[8]=n("div",null,[n("div",{class:"h5"},"แก้ไขแจ้งซ่อม"),n("div",{class:"text-muted"},"แก้ไขข้อมูลคำขอของคุณ")],-1)),n("div",_e,[n("div",ge,v(a.value.createdAt),1),l(ue,{size:"small",color:i.value==="Urgent"?"error":i.value==="High"?"warning":i.value==="Low"?"info":"secondary","text-color":"white"},{default:t(()=>[u(v(i.value),1)]),_:1},8,["color"]),l(re,null,{activator:t(({props:o})=>[l(d,h(o,{variant:"outlined",size:"small"}),{default:t(()=>[...e[7]||(e[7]=[u("การดำเนินการ",-1)])]),_:1},16)]),default:t(()=>[l(se,null,{default:t(()=>[(f(!0),y(ee,null,le(M(a.value.status),o=>(f(),F(ie,{key:o,onClick:ye=>z(o)},{default:t(()=>[l(ne,null,{default:t(()=>[u(v(("getStatusLabel"in r?r.getStatusLabel:te(R))(o)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})])]),_:1}),l(b,{class:"card-body"},{default:t(()=>[l(de,{ref_key:"formRef",ref:w},{default:t(()=>[l(B,null,{default:t(()=>[l(p,{cols:"12"},{default:t(()=>[l(me,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),label:"หัวข้อ",rules:A,required:""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:t(()=>[l(fe,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=o=>V.value=o),label:"รายละเอียด",rows:"6"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"6"},{default:t(()=>[l(ve,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value=o),items:["Low","Normal","High","Urgent"],label:"ความสำคัญ"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"6"},{default:t(()=>[l(pe,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=o=>_.value=o),label:"แนบไฟล์ (ถ้ามี)","show-size":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(ce),l(T,{class:"justify-space-between"},{default:t(()=>[n("div",null,[l(U,{to:"/it-service-request"},{default:t(()=>[l(d,{variant:"text"},{default:t(()=>[...e[9]||(e[9]=[u("ยกเลิก",-1)])]),_:1})]),_:1})]),n("div",null,[l(d,{color:"error",variant:"outlined",class:"me-2",onClick:E},{default:t(()=>[...e[10]||(e[10]=[u("ลบ",-1)])]),_:1}),l(d,{color:"primary",elevation:"2",onClick:I},{default:t(()=>[...e[11]||(e[11]=[u("บันทึก",-1)])]),_:1})])]),_:1})]),_:1})):(f(),y("div",we,[l(C,{style:{width:"100%"}},{default:t(()=>[l(b,null,{default:t(()=>[...e[12]||(e[12]=[u("ไม่พบคำขอนี้",-1)])]),_:1}),l(T,null,{default:t(()=>[l(U,{to:"/it-service-request"},{default:t(()=>[l(d,{variant:"text"},{default:t(()=>[...e[13]||(e[13]=[u("กลับไปยังรายการ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]))]),_:1})]),_:1}),l(ae,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),"max-width":"480"},{default:t(()=>[l(C,null,{default:t(()=>[l(D,null,{default:t(()=>[...e[14]||(e[14]=[u("ยืนยันการลบ",-1)])]),_:1}),l(b,null,{default:t(()=>[e[15]||(e[15]=u("คุณแน่ใจว่าจะลบคำขอนี้: ",-1)),n("strong",null,v(a.value?a.value.title:""),1),e[16]||(e[16]=u(" ?",-1))]),_:1}),l(T,{class:"justify-end"},{default:t(()=>[l(d,{variant:"text",onClick:e[4]||(e[4]=o=>m.value=!1)},{default:t(()=>[...e[17]||(e[17]=[u("ยกเลิก",-1)])]),_:1}),l(d,{color:"error",loading:k.value,onClick:G},{default:t(()=>[...e[18]||(e[18]=[u("ลบ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(oe,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o),timeout:"3000"},{default:t(()=>[u(v(x.value),1)]),_:1},8,["modelValue"])])}}},Ye=X(ke,[["__scopeId","data-v-20ecb7f3"]]);export{Ye as default};
