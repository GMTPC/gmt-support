import{_ as K}from"./D1NlPZts.js";import{_ as Q}from"./CRzN-RqF.js";import{_ as W,am as X,r as d,A as Z,h,a as o,w as e,o as g,u as U,c as D,M as tt,b as s,V as c,f as r,t as u,g as et,an as lt}from"./BX3DXnrd.js";import{a as ot,u as at}from"./BhgsWWkZ.js";import{t as rt,g as st,a as it}from"./CgY8vmlM.js";import{u as nt}from"./h9GH4c1g.js";import{a as $,V as v}from"./Dcv5vhZ4.js";import{V as F,c as L,a as N,e as ut}from"./CEv2fZCT.js";import{V as dt}from"./CZXLAAch.js";import{V as B}from"./DWYXe89p.js";import{V as M}from"./DDt4p3us.js";import{V as ct}from"./EPK2GDdA.js";import{V as mt}from"./CT0Nqr-g.js";/* empty css        */import"./DSgduqRd.js";import"./BudtlS_C.js";import"./DWGaNmQL.js";import"./8gBy0bTw.js";import"./B2HVLM-N.js";import"./kQPmhJOm.js";import"./Dc67yaJp.js";import"./BFwkMqJ3.js";import"./DScwcNyu.js";import"./DEKsWHAV.js";import"./1Ywhgt5G.js";import"./DbEpRz5l.js";const ft={class:"pa-4"},pt={key:0,class:"text-center py-6"},vt={class:"fw-600"},xt={class:"text-muted small"},_t={class:"text-center"},Vt={class:"text-center small"},Ct={class:"text-center"},yt={__name:"index",async setup(gt){let b,k;nt({title:"รายการแจ้งซ่อม - GMT SUPPORT"});const A=ot();A.loaded||([b,k]=X(()=>A.load()),await b,k());const{tickets:q,removeTicket:H,loaded:P}=at(),x=d(""),m=d("All"),z=["All","Low","Normal","High","Urgent"],f=d("All"),I=[{code:"All",label:"ทั้งหมด"},...rt.map(a=>({code:a.code,label:a.label}))],_=Z(()=>{const a=U(q)||[],t=x.value.trim().toLowerCase();return a.filter(n=>{const C=!t||[n.title,n.description,n.priority].filter(Boolean).join(" ").toLowerCase().includes(t),l=m.value==="All"||n.priority===m.value,y=f.value==="All"||n.status===f.value;return C&&l&&y})}),j=[{title:"ลำดับ",value:"index",align:"center",width:80},{title:"หัวข้อ",value:"title"},{title:"วันที่",value:"createdAt"},{title:"สถานะ",value:"status"},{title:"ความสำคัญ",value:"priority"},{title:"การกระทำ",value:"actions",width:180}],R={Low:{color:"info",textColor:"white"},Normal:{color:"secondary",textColor:"white"},High:{color:"warning",textColor:"white"},Urgent:{color:"error",textColor:"white"}},G={requester:{color:"secondary",textColor:"white"},it:{color:"info",textColor:"white"},after_fix:{color:"success",textColor:"white"},exception:{color:"error",textColor:"white"}};function T(a){return R[a]||{color:"secondary",textColor:"white"}}function S(a){const t=st(a)||"requester";return G[t]||{color:"secondary",textColor:"white"}}function O(a){return it(a)}function V(a){return String(a).padStart(2,"0")}function E(a){if(!a)return"";const t=new Date(a);return`${t.getUTCFullYear()}-${V(t.getUTCMonth()+1)}-${V(t.getUTCDate())} ${V(t.getUTCHours())}:${V(t.getUTCMinutes())}`}const p=d(!1),w=d(!1),i=d(null);function Y(a){i.value=a,p.value=!0}async function J(){if(i.value){w.value=!0;try{await H(i.value.id)}catch(a){console.error("Delete failed",a)}finally{w.value=!1,p.value=!1,i.value=null}}}return(a,t)=>{const n=K,C=Q;return g(),h("div",ft,[o($,null,{default:e(()=>[o(v,{cols:"12"},{default:e(()=>[o(n,{showHome:!0,items:[{text:"แจ้งซ่อม",to:"/it-service-request"}]}),o(F,{class:"card-form"},{default:e(()=>[U(P)?tt("",!0):(g(),D(lt,{key:0,indeterminate:"",color:"primary",height:"4",class:"mb-3"})),o(L,{class:"d-flex align-center justify-space-between"},{default:e(()=>[t[7]||(t[7]=s("div",null,"รายการแจ้งซ่อม",-1)),s("div",null,[o(C,{to:"/it-service-request/create"},{default:e(()=>[o(c,{color:"primary",class:"me-2"},{default:e(()=>[...t[6]||(t[6]=[r("แจ้งซ่อมใหม่ IT New Request +",-1)])]),_:1})]),_:1})])]),_:1}),o(N,{class:"card-body"},{default:e(()=>[o($,{class:"mb-4",align:"center"},{default:e(()=>[o(v,{cols:"12",md:"5"},{default:e(()=>[o(dt,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=l=>x.value=l),label:"ค้นหา (หัวข้อ, รายละเอียด)",clearable:"","prepend-inner-icon":"bx-search"},null,8,["modelValue"])]),_:1}),o(v,{cols:"12",md:"3"},{default:e(()=>[o(B,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=l=>m.value=l),items:z,label:"ความสำคัญ"},null,8,["modelValue"])]),_:1}),o(v,{cols:"12",md:"2"},{default:e(()=>[o(B,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=l=>f.value=l),items:I,"item-title":"label","item-value":"code",label:"สถานะ"},null,8,["modelValue"])]),_:1}),o(v,{cols:"12",md:"2",class:"text-end"},{default:e(()=>[o(c,{variant:"tonal",onClick:t[3]||(t[3]=l=>{x.value="",m.value="All",f.value="All"})},{default:e(()=>[...t[8]||(t[8]=[r("รีเซ็ต",-1)])]),_:1})]),_:1})]),_:1}),!_.value||_.value.length===0?(g(),h("div",pt," ยังไม่มีคำขอตามเงื่อนไข ")):(g(),D(ct,{key:1,items:_.value,headers:j,class:"my-data-table",density:"comfortable",sticky:""},{"item.title":e(({item:l})=>[s("div",null,[s("div",vt,u(l.title),1),s("div",xt,u(l.description),1)])]),"item.index":e(({item:l})=>[s("div",_t,u(_.value.findIndex(y=>y.id===l.id)+1),1)]),"item.createdAt":e(({item:l})=>[s("div",Vt,u(E(l.createdAt)),1)]),"item.status":e(({item:l})=>[s("div",Ct,[o(M,{size:"small",color:S(l.status).color,"text-color":S(l.status).textColor},{default:e(()=>[r(u(O(l.status)),1)]),_:2},1032,["color","text-color"])])]),"item.priority":e(({item:l})=>[s("div",null,[o(M,{size:"small",color:T(l.priority).color,"text-color":T(l.priority).textColor},{default:e(()=>[r(u(l.priority),1)]),_:2},1032,["color","text-color"])])]),"item.actions":e(({item:l})=>[o(C,{to:`/it-service-request/update/${l.id}`},{default:e(()=>[o(c,{variant:"outlined",size:"small",class:"me-2"},{default:e(()=>[...t[9]||(t[9]=[r("แก้ไข",-1)])]),_:1})]),_:1},8,["to"]),o(c,{color:"error",variant:"text",size:"small",onClick:et(y=>Y(l),["prevent"])},{default:e(()=>[...t[10]||(t[10]=[r("ลบ ",-1)])]),_:1},8,["onClick"])]),_:1},8,["items"])),o(mt,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=l=>p.value=l),"max-width":"480"},{default:e(()=>[o(F,null,{default:e(()=>[o(L,null,{default:e(()=>[...t[11]||(t[11]=[r("ยืนยันการลบ",-1)])]),_:1}),o(N,null,{default:e(()=>[t[12]||(t[12]=r("คุณแน่ใจว่าจะลบคำขอนี้: ",-1)),s("strong",null,u(i.value?i.value.title:""),1),t[13]||(t[13]=r(" ?",-1))]),_:1}),o(ut,{class:"justify-end"},{default:e(()=>[o(c,{variant:"text",onClick:t[4]||(t[4]=l=>{p.value=!1,i.value=null})},{default:e(()=>[...t[14]||(t[14]=[r("ยกเลิก",-1)])]),_:1}),o(c,{color:"error",loading:w.value,onClick:J},{default:e(()=>[...t[15]||(t[15]=[r("ลบ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])}}},Jt=W(yt,[["__scopeId","data-v-236c36f9"]]);export{Jt as default};
